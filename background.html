<!DOCTYPE html>
<html>
    <head>
    </head>
    <body>
<div id="container">
    <div id="header">
        <div class="inner">
            <div class="logo" title="QQ音乐电台 - 乐你所悦">
                <h1>QQ音乐电台</h1>
                <h2>乐你所悦</h2>
            </div>
            <div class="menu">
                <ul>
                    <li class="username" id="divuserinfo"><a href="javascript:;" name="script_btn" r_onclick="g_user.openLogin(null, 'self');" >登录</a></li>
                    <li><a href="javascript:;" name="script_btn" r_onclick="g_fmChn.goMyFavFmList();" id="divmyfavfm">我收藏的电台</a></li>
                    <li><a href="javascript:;" name="script_btn" r_onclick="g_fmChn.goMyFavSongList();" id="divmyfavsong">我的最爱</a></li>
                </ul>
            </div>
        </div>
    </div>
    <div id="main">
        <div id="player" style="overflow:hidden;">
            <div class="title" id="player_title">
                <h3 id="divfmtitle"></h3>
                <p><a href="javascript:;" name="script_btn" id="share_fm" r_onclick="g_fmChn.shareFm();" title="分享电台">分享电台</a> <a href="javascript:;" name="script_btn" r_onclick="g_fmChn.addFavFm();" title="收藏电台">收藏电台</a></p>
                <b></b>
            </div>
            <div class="song_cover" id="divsongcover">
                <img id="img2" onerror="this.src='http://imgcache.qq.com/mediastyle/musicradio/img/cover.jpg';this.onerror=null;"/>
                <img id="img1" onerror="this.src='http://imgcache.qq.com/mediastyle/musicradio/img/cover.jpg';this.onerror=null;"/>
                <b></b>
                <s></s>
            </div>
            <div class="song_name"><strong id="divsongname"></strong><span class="time" id="divsongtime"></span></div>
            <div class="song_bar"><div class="slider" style="width:0%" id="divsongbar"></div></div>
            <div class="song_volume" onmouseover="document.getElementById('spanvolumebar').className='volume_bar';" onmouseout="document.getElementById('spanvolumebar').className='volume_bar volume_bar_close';"><a class="btn_volume" href="javascript:;" hidefocus="hidefocus">音量</a><span  id="spanvolumebar" class="volume_bar volume_bar_close" onmousedown="g_fmChn.mousedown();" onclick="g_fmChn.updateVol();"><span id="spanvolumeslider" class="slider"></span></span></div>
            <div class="song_opt">
                <p><a class="btn_pause" id="btnplay" href="javascript:;" hidefocus="hidefocus">暂停</a><a class="btn_next" href="javascript:;" name="script_btn" r_onclick="g_fmChn.playNext();" title="下一首" hidefocus="hidefocus">下一首</a><a class="btn_like" id="btnlike" href="javascript:;" title="喜欢" hidefocus="hidefocus">喜欢</a><a class="btn_del" href="javascript:;" name="script_btn" r_onclick="g_fmChn.disLikeSong();" title="不再播放" hidefocus="hidefocus">不再播放</a><span><a class="btn_share" href="javascript:;" name="script_btn" r_onclick="g_fmChn.shareMusic();" title="分享" hidefocus="hidefocus">分享</a><a class="btn_lrc" href="javascript:;" name="script_btn" r_onclick="g_fmChn.showLyricTips();" title="歌词" hidefocus="hidefocus">歌词</a></span></p>
                <b></b>
            </div>
        </div>
        <div id="category">
            <div class="nav" id="nav">
                <ul>
                    <li><a href="#1" id="ch_1" hidefocus="hidefocus">官方电台</a></li>
                    <li><a href="#3" id="ch_3" hidefocus="hidefocus">情感电台</a></li>
                    <li><a href="#2" id="ch_2" hidefocus="hidefocus">歌手电台</a></li>
                </ul>
            </div>
            <div class="list" id="list">
                <div id="content" class="scroll_cont">
                <ul id="content_1" style="display:none;">
                </ul>
                <ul id="content_2" style="display:none;">
                </ul>
                <ul id="content_3" style="display:none;">
                </ul>
                </div>
                <div class="scroll_bar" ><div id="bar" style="height:80px;top:0px;" class="slider" onmouseover="this.className='slider slider_hover'" onmouseout="this.className='slider'"><b></b></div></div>
            </div>
            
            <div class="ulike"><span id="guess_text">不知道听什么？试试</span><a href="#0_100" id="ch_0_100" name="script_btn" r_onclick="g_fmChn.guessYouLike();" hidefocus="hidefocus">“猜你喜欢”电台</a></div>
        </div>
    </div>
    <div id="footer" style="display:none;">
        <p class="copyrighten">Copyright &copy; 1998 - <span id="copyendyear">2011</span> Tencent. <a target="new" class="clink" href="http://www.tencent.com/zh-cn/le/copyrightstatement.shtml">All Rights Reserved</a>.</p>
        <p class="copyrightzh">腾讯公司 <a target="new" href="http://www.tencent.com/zh-cn/le/copyrightstatement.shtml">版权所有</a></p>
    </div>
</div>

<!--http://imgcache.qq.com/music/portal_v3/js/-->
        <script type="text/javascript">
        var _gaq = _gaq || [];
         _gaq.push(['_setAccount', 'UA-18256237-3']);
         _gaq.push(['_trackPageview']);

         (function() {
           var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
           ga.src = 'https://ssl.google-analytics.com/ga.js';
           var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
         })();
        
        </script>

        <script type="text/javascript" src="scripts/jquery.min.js"></script>
        <script type="text/javascript">
            var $j = jQuery.noConflict();
        </script>
        <script type="text/javascript" src="scripts/json2.js"></script>
        
        <script type="text/javascript" src="scripts/qmfl_fm.js"></script>
        <script type="text/javascript" src="scripts/fm.js"></script>
        <script type="text/javascript" src="scripts/h5audio.js"></script>
        
        <script type="text/javascript">
        //hack
        MUSIC.widget.statistics.initPvJs = function(callback) {};
        
        var cookieJar = {};
        
        getCookie = function(name) {
            alert('getCookie: ' + name);
            if(cookieJar[name] != undefined) {
                alert('getCookie return' + cookieJar[name]);
                return cookieJar[name];
            }
        
            var flag = false;
            var obj = null;
            
            chrome.cookies.get({'name':name, 'url':'http://qq.com'}, function(ck){
                if(ck) {
                    cookieJar[name] = ck.value;
                }
            });
            alert('getCookie return ""');
            return "";
        }

        var g_uin = 0;
        g_user.getUin = function() {
            return g_uin;
        }

        
        
        //hack end
        
        var isPause = true;
        var firstPause = true;
        
        var g_infoObj = !! localStorage["curFmInfo"] && JSON.parse(localStorage["curFmInfo"]) || { fmId : 118, fmName: "华语" ,
        fmType : 1};
        
        function OnSongPlayEnd(songinfo, index, total) {
            _gaq.push(['_trackEvent', 'Song', 'Ended', songInfo.msong + ' - ' + songInfo.msinger]);
        }
        
        var proxy = (function(){
            function start() {
                //采用hasttag来指定起始播放的频道
                MUSIC.util.gLocation += "#"+g_infoObj.fmId+"_"+g_infoObj.fmType;
                        
                g_fmChn.init({fmInfoObj:{"type1":[{id:118,name:"华语",i:1},{id:119,name:"粤语",i:1},{id:120,name:"欧美",i:1},{id:149,name:"日语",i:1},{id:150,name:"韩语",i:1},{id:126,name:"新歌",i:1},{id:122,name:"70后",i:1},{id:123,name:"80后",i:1},{id:124,name:"90后",i:1},{id:129,name:"轻音乐",i:1},{id:130,name:"摇滚",i:1},{id:135,name:"慢摇",i:1},{id:132,name:"爵士",i:1},{id:133,name:"乡村",i:1},{id:134,name:"电子",i:1},{id:131,name:"古典",i:1},{id:127,name:"经典",i:1},{id:145,name:"影视",i:1},{id:144,name:"动漫",i:1},{id:146,name:"胎教",i:1},{id:148,name:"音乐人",i:1}],"type2":[{id:143,name:"陈奕迅",i:2},{id:4558,name:"周杰伦",i:2},{id:265,name:"王力宏",i:2},{id:174,name:"张学友",i:2},{id:163,name:"刘德华",i:2},{id:101,name:"陶",i:2},{id:74,name:"五月天",i:2},{id:264,name:"王菲",i:2},{id:141,name:"张惠妹",i:2},{id:109,name:"孙燕姿",i:2},{id:44,name:"梁静茹",i:2},{id:113,name:"Twins",i:2},{id:10,name:"陈绮贞",i:2},{id:54,name:"莫文蔚",i:2},{id:51,name:"刘若英",i:2},{id:4615,name:"李宇春",i:2},{id:7221,name:"许嵩",i:2},{id:5829,name:"凤凰传奇",i:2},{id:227,name:"蔡依林",i:2},{id:2923,name:"Linkin Park",i:2},{id:4708,name:"Britney Spears",i:2},{id:4716,name:"Madonna",i:2},{id:4161,name:"Beyonce Knowles",i:2},{id:4404,name:"WestLife",i:2},{id:16257,name:"Justin Bieber",i:2},{id:4712,name:"迈克尔・杰克逊",i:2},{id:13769,name:"Lady GaGa",i:2},{id:4417,name:"Avril Lavigne",i:2},{id:4880,name:"Eminem",i:2},{id:1660,name:"Jeff Foxworthy",i:2},{id:11733,name:"BigBang",i:2},{id:11809,name:"少女时代",i:2},{id:4800,name:"滨崎步",i:2},{id:4915,name:"东方神起",i:2},{id:5675,name:"Super Junior",i:2},{id:5161,name:"久石让",i:2},{id:126,name:"小野丽莎",i:2},{id:5484,name:"蔡妍",i:2},{id:4435,name:"宝儿",i:2},{id:4706,name:"Rain",i:2}],"type3":[{id:136,name:"伤感",i:3},{id:137,name:"寂寞",i:3},{id:138,name:"甜蜜",i:3},{id:140,name:"快乐",i:3}]}});
                
                g_fmChn.setCurChnType = function(fmType) {};
                g_webPlayer.OnSongPlayEnd = OnSongPlayEnd;

                checkUin(function(uin){
                    g_fmChn.myFavSong.getList();
                });

                _gaq.push(['_trackEvent', 'Channel', 'Starts With', g_infoObj.fmName]);
            }
            
            function OnSave(fmInfoObj) {
                if(fmInfoObj.fmId != g_infoObj.fmId) {
                    g_infoObj = fmInfoObj;
                    g_fmChn.setChnAndList(g_infoObj.fmId, g_infoObj.fmType);
                    
                    g_webPlayer.OnSongPlayEnd = OnSongPlayEnd;
                    isPause = false;
                    _gaq.push(['_trackEvent', 'Channel', 'Change To', g_infoObj.fmName]);
                }
            }
            
            return {
                start : start,
                OnSave : OnSave
            }
        })();
        
        function getFMCookie() {
            return;
            var iframe = document.createElement('iframe');
            iframe.onload = (function(iframe) {
                return function() {
                    iframe.parentNode.removeChild(iframe);
                }
            })(iframe);
            var url = "http://qzone-music.qq.com/fcg-bin/fcg_set_musiccookie.fcg?fromtag=29&p="+Math.random();
            iframe.src = url;
            document.body.appendChild(iframe);
        }
        
        function checkUin(cb, err_cb) {
            var real_cb = function(ck) {
                if(ck == null) {
                    g_uin = 0;
                }
                else {
                    var _puin = ck.value;
                    if (_puin.indexOf('o') == 0) {
                        _uin = parseInt(_puin.substring(1, _puin.length), 10);
                    } else {
                        _uin = parseInt(_puin, 10);
                    }
                    g_uin = _uin;
                }

                if(g_uin != 0) {
                    if(cb) {
                        cb(g_uin);
                    }
                }
                else {
                    if (err_cb) {
                        err_cb();
                    }
                }
            }
            chrome.cookies.get({ 'name' : 'uin', 
                    'url' : 'http://qq.com'
                    }, real_cb);
        }

        function trackVersion() {
            $j.getJSON('manifest.json', function(data){

                _gaq.push(['_trackEvent', 'Version', 'loads', data.version]);
            }); 
        }
        
        function hackFunc(obj, name, func) {
            var funcName = '(' + name+ ')(' + func.name + ')';
            var f = (function(obj, func){
                return function(){
                    console.log(funcName + ' called');
                    console.log(arguments);
                    func.apply(obj, arguments);
                }
            })(obj, func);
            console.log(funcName + ' attached');
            obj[name] = f;
            
        }
        function traverse(obj) {
            for(var i in obj) {
                if(typeof obj[i] == "function") {
                    console.log(i);
                    console.log(isFunction(obj[i]));
                    hackFunc(obj, i, obj[i]);
                }
            }
        }
        
        function isFunction(func) {
            var count = 0;
            for(var i in func.prototype) {
                count++;
            }
            return count == 0;
        }
        
        window.debugMode = true;
        MUSIC.config.debugLevel = 2;
        function _log(msg) {
            console.log(msg);
        }
        MUSIC.debug.errorLogs = { push : _log };
        window.alert = _log;
        
        MUSIC.event.onDomReady(function(){
            trackVersion();
        });
        </script>
        
    </body>
</html>
