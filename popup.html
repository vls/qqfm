<html>
	<head>
		<meta charset="gb2312">
		<link rel="stylesheet" href="c/default.css">
		<style type="text/css">
		body {
			width: 428px;
			margin: 0;
			height: 104px;
			background-color: #000000;
		}
		/*
		.song_opt {
			position: static;
		}
		.song_opt b {
			position: static;
		}
		*/
		#songInfo {
			float: right;
			margin-top: 12px;
			margin-right: 10px;
			
		}
		#player {
			height : 104px;
		}
		#options {
			position: absolute;
			margin-left: 10px;
			margin-top: 7px;
			background-color: #000000;
		}
		#notice {
			float: right;
			position: absolute;
			margin-top : 7px;
			right: 8px;
			cursor: pointer;
		}
		</style>
	</head>
	<body style="display:none">
	
		<div id="player" style="overflow:hidden;">
			<!--
			<div class="title" id="player_title" style="left: 0px; top: -74px; ">
				<h3 id="divfmtitle">华语</h3>
				<p><a href="javascript:;" name="script_btn" id="share_fm" title="分享电台">分享电台</a> <a href="javascript:;" name="script_btn" title="收藏电台">收藏电台</a></p>
				<b></b>
			</div>
			
			<div class="song_cover" id="divsongcover">
				<img id="img2" onerror="this.src='http://imgcache.qq.com/mediastyle/musicradio/img/cover.jpg';this.onerror=null;" src="http://ctc.imgcache.qq.com/music/photo/album/63/albumpic_70363_0.jpg" style="opacity: 0.99; ">
				<img id="img1" onerror="this.src='http://imgcache.qq.com/mediastyle/musicradio/img/cover.jpg';this.onerror=null;" style="opacity: 0.02; ">
				<b></b>
				<s></s>
			</div>
			-->
			<div class="song_name">
				<strong id="divchnname"></strong>
				<span id="options">
				<a href="javascript:openOptions()" ><img src="images/gear.png" title="设置频道" /></a>
				</span>
				<span id="notice"><img src="images/about.png" title="如果点击播放后有歌曲名而无时间倒数，请打开http://fm.qq.com一次再试即可"></span>
				<b></b>
			</div>
			<div class="song_name"><a id="a_songname" target="_blank" style="color:white" title="点击下载"><strong id="divsongname"></strong></a><span class="time" id="divsongtime"></span></div>
			
			<div class="song_bar"><div class="slider" style="width: 0%; " id="divsongbar"></div></div>
			
			<div class="song_volume" onmouseover="document.getElementById('spanvolumebar').className='volume_bar';" onmouseout="document.getElementById('spanvolumebar').className='volume_bar volume_bar_close';"><a class="btn_volume" href="javascript:;" hidefocus="hidefocus">音量</a><span id="spanvolumebar" class="volume_bar volume_bar_close"
			onclick="updateVol(event);" title="音量：75%"><span id="spanvolumeslider" class="slider" style="width: 75%; "></span></span></div>
			<div class="song_opt"><!-- r_onclick="g_fmChn.pauseFm();"-->
				<p>
				<a class="btn_pause" id="btnpause" href="javascript:;" hidefocus="hidefocus" title="播放">播放</a>
				<a class="btn_next" id="btnnext" href="javascript:;" name="script_btn" title="下一首" hidefocus="hidefocus">下一首</a>
				<!--
				<a class="btn_like" id="btnlike" href="javascript:;" title="喜欢" hidefocus="hidefocus">喜欢</a>
				
				<a class="btn_del" href="javascript:;" name="script_btn" title="不再播放" hidefocus="hidefocus">不再播放</a>
				
				
				<span><a class="btn_share" href="javascript:;" name="script_btn" title="分享" hidefocus="hidefocus">分享</a><a class="btn_lrc" href="javascript:;" name="script_btn" title="歌词" hidefocus="hidefocus">歌词</a></span>
				
				-->
				</p>
				<b></b>
			</div>
		</div>
		<script type="text/javascript">
		var _gaq = _gaq || [];
		 _gaq.push(['_setAccount', 'UA-18256237-3']);
		 _gaq.push(['_trackPageview']);

		 function initGA() {
		   var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		   ga.src = 'https://ssl.google-analytics.com/ga.js';
		   var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		 };
		 
		 setTimeout(initGA, 500);
		
		</script>
		
		<script type="text/javascript" src="scripts/jquery.min.js"></script>
		<script type="text/javascript">
		var bg = chrome.extension.getBackgroundPage();
		
		function trackButton(button_id) {
			_gaq.push(['_trackEvent', button_id, 'clicked']);
		};
		
		$("#btnnext").click(function(){
			bg.isPause = false;
			OnPlaying();
			
			
			trackButton('btn_next');
			if(bg.firstPause) {
				bg.firstPause = false;
				bg.proxy.start();
			}
			else {
				var songInfo = bg.g_webPlayer.getSongInfoObj();
				_gaq.push(['_trackEvent', 'Song', 'Click Next', songInfo.msong + ' - ' + songInfo.msinger]);
				
				bg.g_fmChn.playFm(bg.g_fmChn._curFmInfo);
			}
			
			setTimeout(updateSongInfo, 1000);
		});
		
		$("#btnpause").click(function(){
			
			if(!bg.isPause) {
				trackButton('btn_pause');
				// pause
				bg.isPause = true;
				
				OnPlayPause();
				
				bg.g_webPlayer.pausePlayer();
			}
			else {
				trackButton('btn_play');
				// play
				bg.isPause = false;
				OnPlaying();
				if(bg.firstPause) {
					
					bg.firstPause = false;
					bg.proxy.start();
			
					setTimeout(updateSongInfo, 1000);
				}
				else {
					bg.g_webPlayer.startPlayer();
				}
				
			}
		});
		
		function init() {
		}
		
		
		function mouseY(evt) {
			return evt.pageY || (evt.clientY + (document.documentElement.scrollTop || document.body.scrollTop));
		}
		
		function mouseX(evt) {
			return evt.pageX || (evt.clientX + (document.documentElement.scrollLeft || document.body.scrollLeft));
		}
		
		function updateVol(e) {
			var D = bg.MUSIC.dom,
				volumebar = $("#spanvolumebar").get(0),
				volumeslider = $("#spanvolumeslider").get(0),
				pos = D.getPosition(volumebar),
				eventx = mouseX(e),
				vol = parseInt((eventx - pos["left"]) * 100 / pos["width"], 10);
			if (!isNaN(vol) && (vol >= 0 && vol < 101)) {
				volumebar.title = "音量：" + vol + "%";
				volumeslider.style.width = vol + "%";
				bg.g_webPlayer.setVolumn(vol);
			}
		}
		
	
		
		function updateSongInfo() {
			var songInfo = bg.g_webPlayer.getSongInfoObj();
			updateCurSong(songInfo);
			bg.g_webPlayer.OnSongPlaying = updateSongBar;
			getChnName($("#divchnname"));
		}
		
		function updateSongBar(curtime, totaltime) {
			function formatTime(seconds) {
				var mins = parseInt(seconds / 60, 10),
					secs = parseInt(seconds % 60, 10);
				return mins + ":" + (secs > 9 ? "" : "0") + secs;
			}
			
			$("#divsongtime").get(0).innerHTML = '-' + formatTime(totaltime - curtime);
			$("#divsongbar").get(0).style.width = parseInt(curtime * 100 / totaltime, 10) + '%';
		}
		
		function OnPlayPause() {
			var _btnPlay = $("#btnpause").get(0);
			_btnPlay.className = "btn_play";
			_btnPlay.innerHTML = "播放";
			_btnPlay.title = "播放";
		}
		
		function OnPlaying() {
			var _btnPlay = $("#btnpause").get(0);
			_btnPlay.className = "btn_pause";
			_btnPlay.innerHTML = "暂停";
			_btnPlay.title = "暂停";
		}
		
		function updateCurSong(songInfo) {
			$("#divsongname").get(0).innerHTML = songInfo.msong + ' - ' + songInfo.msinger;
			$("#divsongbar").get(0).style.width = '0%';
			$("#divsongtime").get(0).innerHTML = '';
			
			var url = "http://stream1"+songInfo.mstream+".qqmusic.qq.com/"+(parseInt(songInfo.mid)+30000000)+".mp3";
			$("#a_songname").attr("href", url);
		}
		
		function OnSongPlayBegin(songinfo, index, total) {
			updateCurSong(songinfo);
		}
		
		
		function getChnName(node) {
			var chn = $(bg.MUSIC.channel.fm._curChn).text();
			
			if (chn == "") {
				chn = bg.g_infoObj.fmName;
			}
			
			var node = $(node);
			node.text(chn);
		}
		
		function showbody() {
			$(document.body).show();
		}
		
		function openOptions() {
			_gaq.push(['_trackEvent', 'Option Page', 'Opened']);
			chrome.tabs.create({ url: "options.html" });
		}
		
		
		var song_info = "";
		$(document).ready(function(){
			showbody();
		
			init();
		
			updateSongInfo();
			
			bg.g_webPlayer.OnSongPlaying = updateSongBar;
			bg.g_webPlayer.OnSongPlayBegin = OnSongPlayBegin;
			
			
			getChnName($("#divchnname"));
			
			if(bg.isPause) {
				OnPlayPause();
				
			}
			else {
				OnPlaying();
			}
			
			
			
		});
		</script>
	</body>
</html>